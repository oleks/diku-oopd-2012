\ProvidesPackage{oleks}

\PassOptionsToPackage{table}{xcolor}
\PassOptionsToPackage{usenames,dvipsnames}{color}

\PassOptionsToPackage{utf8}{inputenc}
\PassOptionsToPackage{russian,english}{babel}

\PassOptionsToPackage{T2A,T1}{fontenc}

\newcommand\dofancy{false}
\DeclareOption{fancy}{\renewcommand\dofancy{true}}
\ProcessOptions\relax

\RequirePackage{graphicx}
\RequirePackage{xparse}
\RequirePackage{xstring}
\RequirePackage{ifthen}
\RequirePackage{xkeyval}

\RequirePackage{expdlist}
\RequirePackage{multirow}
\RequirePackage{paralist}

%colors

\RequirePackage{color}
\RequirePackage{xcolor}
\definecolor{shade}{RGB}{245,245,245}

% langauge

\RequirePackage{inputenc}
\RequirePackage{babel}

% font

\RequirePackage{fontenc}
\RequirePackage{mathpazo}

% math

\RequirePackage{amssymb}
\RequirePackage{amsmath}
\RequirePackage{amsthm}

\everymath{\displaystyle}

% code

\RequirePackage{clrscode3e}
\RequirePackage{verbatim}
\RequirePackage{listings}
\lstset
{
	tabsize=2,
	numbers=left,
	breaklines=true,
	backgroundcolor=\color{shade},
	framexleftmargin=0.05in,
	basicstyle=\ttfamily\small,
	numberstyle=\tiny,
	keywordstyle=\color{RoyalBlue},
	stringstyle=\color{Maroon},
	commentstyle=\color{ForestGreen}
}


% links

\RequirePackage{url}
\RequirePackage[pdftex,colorlinks=true]{hyperref}
\hypersetup
{
	bookmarksnumbered,
	linkcolor=RoyalBlue,
	anchorcolor=RoyalBlue,
	citecolor=RoyalBlue,
	urlcolor=RoyalBlue,
	pdfstartview={FitV},
	pdfdisplaydoctitle
}

% setup

\newcommand{\subject}{[subject not setup]}
\newcommand{\setSubject}[1]{%
	\renewcommand{\subject}{#1}%
}

\newcommand{\location}{[location not setup]}
\newcommand{\setLocation}[1]{%
	\renewcommand{\location}{#1}%
}


\newcommand{\assignment}{\empty}
\newcommand{\setAssignment}[1]{%
	\renewcommand{\assignment}{#1}\title{#1}\hypersetup{pdftitle=#1}%
}
\setAssignment{[assignment not setup]}

\newcommand{\staticDate}{\empty}
\newcommand{\setStaticDate}[1]{%
	\renewcommand{\staticDate}{#1}\date{#1}%
}
\setStaticDate{[date not setup]}

\define@key{setup}{assignment}{\setAssignment{#1}}
\define@key{setup}{date}{\setStaticDate{#1}}
\define@key{setup}{subject}{\setSubject{#1}}
\define@key{setup}{location}{\setLocation{#1}}
\NewDocumentCommand\setup{m}{\setkeys{setup}{#1}}

% author

\newcommand{\shortAuthor}{\empty}
\newcommand{\setShortAuthor}[1]{%
	\renewcommand{\shortAuthor}{#1}%
}

\newcommand{\longAuthor}{\empty}
\newcommand{\setLongAuthor}[1]{%
	\renewcommand{\longAuthor}{#1}%
	\author{#1}%
	\hypersetup{pdfauthor=#1}%
	\setShortAuthor{#1}%
}
\setLongAuthor{[author not setup]}

\newcommand{\authorAddendum}{\empty}
\newcommand{\setAuthorAddendum}[1]{%
	\renewcommand{\authorAddendum}{#1}%
}

\define@key{setupAuthor}{short}{\setShortAuthor{#1}}
\define@key{setupAuthor}{addendum}{\setAuthorAddendum{#1}}
\NewDocumentCommand\setupAuthor{O{}m}{%
	\setLongAuthor{#2}%
	\setkeys{setupAuthor}{#1}%
}

% fancy

\ifthenelse{\equal{\dofancy}{true}}{

%\RequirePackage{fullpage}
\RequirePackage{fancyhdr}
\RequirePackage{lastpage}

\pagestyle{fancy}
\lhead{\footnotesize\shortAuthor\\\authorAddendum}
\chead{\footnotesize\subject\\\assignment}
\rhead{\footnotesize\location\\\staticDate}
\cfoot{\thepage/\pageref*{LastPage}}
\renewcommand{\headrulewidth}{0in}
\renewcommand{\headsep}{40pt}
\setlength{\headheight}{20pt}
\addtolength{\textheight}{-20pt}

\fancypagestyle{first}
{
	\fancyhf{}
	\cfoot{\thepage/\pageref*{LastPage}}
}
}{}

% figures

\NewDocumentCommand\includeFigure{O{1}mmO{htbp!}}
{
	\begin{figure}[#4]
	\centering%
	\IfDecimal{#1}%
  {%
		\includegraphics[scale=#1]{figures/#2}%
	}%
	{%
		\includegraphics[#1]{figures/#2}%
	}%
	\caption[]{#3}%
	\label{figure:#2}%
	\end{figure}
}

% captions

\RequirePackage[hang,small,bf]{caption}

% references

\NewDocumentCommand\referToChapter{m}%
{%
	Chapter \ref{chapter:#1}/\pageref{chapter:#1}%
}%

\NewDocumentCommand\referToSection{m}%
{%
	\textsection\ \ref{section:#1}/\pageref{section:#1}%
}%

\NewDocumentCommand\referToFigure{m}%
{%
	Figure \ref{figure:#1}/\pageref{figure:#1}%
}%

\NewDocumentCommand\referToTable{m}%
{%
	Table \ref{table:#1}/\pageref{table:#1}%
}%

% sections

\NewDocumentCommand\startSectionAux{O{\empty}O{section}mm}
{%
	\lowercase{
		\ifthenelse{\equal{#1}{\empty}}
		{\def\templabel{#3}}
		{\def\templabel{#1}}
	}

	\StrSubstitute{\templabel}{ }{-}[\templabel]
	\StrSubstitute{\templabel}{,}{}[\templabel]
	\StrSubstitute{\templabel}{'}{}[\templabel]

	\csname#4\endcsname{#3}\label{#2:\templabel}
}

\NewDocumentCommand\startSection{O{1}mO{\empty}}
{
	\ifthenelse{\equal{#1}{2}}
	{\startSectionAux[#3]{#2}{subsection}}
	{\ifthenelse{\equal{#1}{3}}
	{\startSectionAux[#3]{#2}{subsubsection}}
	{\startSectionAux[#3]{#2}{section}}
	}
}

% tables

\NewDocumentCommand\makeTable{O{htbp!}mmmmm}
{
	\begin{table}[#1]
	\centering
	\rowcolors{2}{shade}{white}
	\begin{tabular}{#4}
	#5\\
	#6\\
	\end{tabular}
	\caption[]{#3}
	\label{table:#2}
	\end{table}
}

\RenewDocumentCommand\maketitle{}
{
	\begin{center}
	\LARGE\assignment\\\ \\
	\large\longAuthor\\
	\normalsize\authorAddendum\\\ \\
	\normalsize\staticDate
	\end{center}
	\ifthenelse{\equal{\dofancy}{true}}{\thispagestyle{first}}{}
}

% other shorthands

\NewDocumentCommand\mono{m}{{\ttfamily#1}}

\NewDocumentCommand\email{m}{\mono{\href{mailto:#1}{#1}}}

% math mode shorthands

\NewDocumentCommand\textt{m}{\ensuremath{\text{\mono{#1}}}}
\NewDocumentCommand\nonterm{m}{\textt{<#1>}}
\NewDocumentCommand\term{m}{\textt{`#1'}}
\NewDocumentCommand\ceil{m}{\ensuremath{\left\lceil{#1}\right\rceil}}
\NewDocumentCommand\floor{m}{\ensuremath{\left\lfloor{#1}\right\rfloor}}
\NewDocumentCommand\set{m}{\ensuremath{\left\{{#1}\right\}}}
\NewDocumentCommand\st{m}{\ensuremath{\left|{#1}\right.}}
\NewDocumentCommand\seq{m}{\ensuremath{\left[{#1}\right]}}
\NewDocumentCommand\card{m}{\ensuremath{\left|{#1}\right|}}
\NewDocumentCommand\parens{m}{\ensuremath{\left({#1}\right)}}
\NewDocumentCommand\p{m}{\ensuremath{\left({#1}\right)}}
\NewDocumentCommand\tuple{m}{\ensuremath{\left\langle{#1}\right\rangle}}
\NewDocumentCommand\iverson{m}{\seq{#1}}

\NewDocumentCommand\cyrtext{m}{{\fontencoding{T2A}\selectfont #1}}
